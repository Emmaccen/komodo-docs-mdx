# AtomicDEX API RPC Protocol v2.0

Starting with version [beta-2.1.3434](https://github.com/KomodoPlatform/atomicDEX-API/releases/tag/beta-2.1.3434), the AtomicDEX API supports the standardized protocol format called `mmrpc 2.0`.

It includes a uniform request, successful and error response formats. At the moment, only a few RPC methods support the `mmrpc 2.0` protocol.

## Request

| Structure | Type              | Description                                                                                                                                                       |
| --------- | ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| mmrpc     | string            | the string specifying the version of the AtomicDEX API RPC protocol. Must be exactly "2.0"                                                                        |
| userpass  | string (optional) | your password for protected RPC methods. Skip this field if the specified `method` is public                                                                      |
| method    | string            | the name of the method to be invoked                                                                                                                              |
| params    | object (optional) | a structured value that holds the parameter values to be used during the invocation of the method. This field may be omitted if the method doesn't take arguments |
| id        | number (optional) | the identifier is established by the client. AtomicDEX API will reply with the same value in the Response object if the `id` field is included and not `NULL`     |

### Response (Success)

| Structure | Type              | Description                                                                                 |
| --------- | ----------------- | ------------------------------------------------------------------------------------------- |
| mmrpc     | string            | the string specifying the version of the AtomicDEX API RPC protocol                         |
| result    | object            | the value of this field is determined by the method invoked on AtomicDEX API                |
| id        | number (optional) | the identifier established by the client. The same value as in the Request if it was passed |

### Response (Error)

| Structure   | Type              | Description                                                                                 |
| ----------- | ----------------- | ------------------------------------------------------------------------------------------- |
| mmrpc       | string            | the string specifying the version of the AtomicDEX API RPC protocol                         |
| error       | string            | the common error description                                                                |
| error_path  | string            | the error path consisting of file names separated by a dot similar to JSON path notation    |
| error_trace | string            | the error path consisting of file and line number pairs separated by ']'                    |
| error_type  | string            | the string error identifier used to determine the cause of the error                        |
| error_data  | object            | an object containing the error data of the corresponding `error_type`                       |
| id          | number (optional) | the identifier established by the client. The same value as in the Request if it was passed |

### ðŸ“Œ Examples

#### Command

<CodeGroup title="" tag="POST" label="withdraw">
```json {{ mm2MethodDecorate : true }}
{
  "mmrpc": "2.0",
  "userpass": "$userpass",
  "method": "withdraw",
  "params": {
    "coin": "KMD",
    "to": "RJTYiYeJ8eVvJ53n2YbrVmxWNNMVZjDGLh",
    "amount": "10"
  },
  "id": 0
}
```
</CodeGroup>

<CollapsibleSection expandedText='Hide Response' collapsedText='Show Response'>

#### Response (success)

```json
{
  "mmrpc": "2.0",
  "result": {
    "tx_hex": "0400008085202f8901ef25b1b7417fe7693097918ff90e90bba1351fff1f3a24cb51a9b45c5636e57e010000006b483045022100b05c870fcd149513d07b156e150a22e3e47fab4bb4776b5c2c1b9fc034a80b8f022038b1bf5b6dad923e4fb1c96e2c7345765ff09984de12bbb40b999b88b628c0f9012102031d4256c4bc9f99ac88bf3dba21773132281f65f9bf23a59928bce08961e2f3ffffffff0200e1f505000000001976a91405aab5342166f8594baf17a7d9bef5d56744332788ac8cbaae5f010000001976a91405aab5342166f8594baf17a7d9bef5d56744332788ace87a5e5d000000000000000000000000000000",
    "tx_hash": "1ab3bc9308695960bc728fa427ac00d1812c4ae89aaa714c7618cb96d111be58",
    "from": ["R9o9xTocqr6CeEDGDH6mEYpwLoMz6jNjMW"],
    "to": ["R9o9xTocqr6CeEDGDH6mEYpwLoMz6jNjMW"],
    "total_amount": "60.10253836",
    "spent_by_me": "60.10253836",
    "received_by_me": "60.00253836",
    "my_balance_change": "-0.1",
    "block_height": 0,
    "timestamp": 1566472936,
    "fee_details": {
      "type": "Utxo",
      "amount": "0.1"
    },
    "coin": "RICK",
    "internal_id": ""
  },
  "id": 0
}
```
</CollapsibleSection>

<CollapsibleSection expandedText='Hide Error Response' collapsedText='Show Error Response'>
#### Response (error)

```json
{
  "mmrpc": "2.0",
  "error": "The amount 0.000005 is too small",
  "error_path": "utxo_common",
  "error_trace": "utxo_common:1379] utxo_common:301]",
  "error_type": "AmountIsTooSmall",
  "error_data": {
    "amount": "0.000005"
  },
  "id": 0
}
```
</CollapsibleSection>


## Common AtomicDEX-API Request / Response Objects

The folowing objects are used in the request or response of multiple AtomicDEX-API methods.


### AddressInfos

The `addressInfos` object includes the following items for a given address:

| Parameter              | Type      | Description                                                                                                                                      |
| ---------------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| balances               | object    | A standard [balanceInfos](/atomicdex/api/v20#balance-infos) object. Not included in responses where `get_balances` is `false`  |
| derivation_method      | object    | A standard [DerivationMethod](/atomicdex/api/v20#derivation-method) object                                                    |
| pubkey                 | string    | The public key associated with the seed used to launch AtomicDEX                                                                                 |
| tickers                | array     | A list of tokens which were successfully activated. Only included in responses where `get_balances` is `false`                                   |


<CollapsibleSection expandedText='Hide Examples' collapsedText='Show Examples'>

#### Example with balances

```json
"bitcoincash:qrf5vpn78s7rjexrjhlwyzzeg7gw98k7t5qx64fztj": {
    "derivation_method": {
        "type": "Iguana"
    },
    "pubkey": "036879df230663db4cd083c8eeb0f293f46abc460ad3c299b0089b72e6d472202c",
    "balances": {
        "spendable": "0.11398301",
        "unspendable": "0.00001"
    }
}
```

#### Example without balances

```json
"bitcoincash:qrf5vpn78s7rjexrjhlwyzzeg7gw98k7t5qx64fztj": {
    "derivation_method": {
        "type": "Iguana"
    },
    "pubkey": "036879df230663db4cd083c8eeb0f293f46abc460ad3c299b0089b72e6d472202c",
    "tickers": ["ASLP-SLP"]
}
```

</CollapsibleSection>


### BalanceInfos

The `balanceInfos` object includes the following items for a given coin or token:

| Parameter     | Type             | Description                                                                                                               |
| ------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------- |
| spendable     | string (numeric) | The available amount of a coin or token which is ready to be traded or withdrawn.                                         |
| unspendable   | string (numeric) | The amount of a coin or token which is awaiting confirmation on the block chain for an incoming or outgoing transaction.  |


<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "spendable": "12.11398301",
    "unspendable": "0.53"
}
```

</CollapsibleSection>


### DerivationMethod

The `DerivationMethod` object includes the following items for a given coin or token:

| Parameter     | Type   | Description                                                                                                               |
| ------------- | ------ | ------------------------------------------------------------------------------------------------------------------------- |
| type          | string | Possible values: `Iguana`                                                            |

{/* <!-- TODO: insert more types in the above table --> */}

Where the value indicates:
 - `Iguana`: The coin or token is was activated using Iguana derivation (default).

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "type": "Iguana"
}
```

</CollapsibleSection>


### EvmNode

The `EvmNode` object includes the following items for a given coin or token:

| Parameter | Type    | Description                                                                                                                                                                            |
| --------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| url       | string  | URL of an RPC node                                                                                                                                                                     |
| gui_auth  | boolean | Optional, defaults to `false`. Must be set to `true` to access RPC nodes run officially by the Komodo Platform team                                                                        |

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "url": "http://eth1.cipig.net:8555",
    "gui_auth": false
}
```

</CollapsibleSection>


### TokensRequest

The `TokensRequest` object includes the following items for a given coin or token:

| Parameter              | Type    | Description                                                                                                                                                                            |
| ---------------------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ticker                 | string  | Ticker of the token to be enabled                                                                                                                                                      |
| required_confirmations | integer | How many confirmations to wait during the transaction steps of an atomic swap. Overwrites value in coins file; defaults to `3`                                                         |

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "ticker": "MINDS-ERC20",
    "required_confirmations": 4
}
```

</CollapsibleSection>



### Pagination

For requests which return many results, pagination offsets may be applied. ** Use either value, not both. **

| Parameter  | Type    | Description                                                |
|------------|---------|------------------------------------------------------------|
| PageNumber | integer | Optional, defaults to `1`. Offset for paginated results    |
| FromId     | integer | Optional. Ignores any results prior to this UUID           |


<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "PageNumber": 1
}
```

```json
{
    "FromId": 4
}
```
</CollapsibleSection>


### LightningPayment

| Parameter            | Type    | Description                                                                                                                           |
|----------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------|
| type                 | string  | The payment type. Accepted values are `invoice` or `keysend`.                                                                         |
| invoice              | string  | Only used if `type` is `invoice`. An identifying string which represents the invoice.                                                 |
| destination          | string  | Only used if `type` is `keysend`. A pubkey or address which will receive the payment.                                                 |
| amount_in_msat       | string  | Only used if `type` is `keysend`. Amount to be paid, in [millisatoshis](https://bitcoindata.science/bitcoin-units-converter.html) (A thousandth of a satoshi; the same as 0.00000000001 bitcoin.) |
| expiry               | string  | Only used if `type` is `keysend`. Optional, defaults to `3600`. Seconds until the payment expires.                                    |


### LightningPaymentFilter

| Parameter            | Type    | Description                                                                                                                           |
|----------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------|
| payment_type         | object  | A standard `LightningPaymentType` object.                                                                                             |
| description          | string  | Optional. A note to indicate the purpose of the invoice.                                                                              |
| status               | string  | Optional. Accepted values: `pending`, `succeeded`, `failed`.                                                                          |
| from_amount_msat     | integer | Optional. Minimum amount sent in [millisatoshis](https://bitcoindata.science/bitcoin-units-converter.html                             |
| to_amount_msat       | integer | Optional. Maximum amount sent in [millisatoshis](https://bitcoindata.science/bitcoin-units-converter.html                             |
| from_fee_paid_msat   | integer | Optional. Minimum transaction fee paid in [millisatoshis](https://bitcoindata.science/bitcoin-units-converter.html                    |
| to_fee_paid_msat     | integer | Optional. Maximum transaction fee paid in [millisatoshis](https://bitcoindata.science/bitcoin-units-converter.html                    |
| from_timestamp       | string  | Optional. Minimum timestamp (in milliseconds) of payment results to return.                                                           |
| to_timestamp         | string  | Optional. Maximum timestamp (in milliseconds) of payment results to return.                                                           |


### LightningPaymentType

| Parameter    | Type    | Description                                                                                                                           |
|--------------|---------|---------------------------------------------------------------------------------------------------------------------------------------|
| type         | object  | Accepted values are `Outbound Payment` or `Inbound Payment`.                                                                          |
| destination  | string  | Only used if `type` is `Outbound Payment`. A pubkey or address which will receive the payment.                                        |


### LightningChannelAmount

| Parameter  | Type    | Description                                                                                   |
|------------|---------|-----------------------------------------------------------------------------------------------|
| type       | string  | `Exact` for a specific amount or `Max` for whole balance.                                     |
| value      | object  | Only required if type is `Exact`. The amount in BTC you want to open the channel with.        |


### LightningChannelOptions

| Parameter                              | Type    | Description                                                                                   |
|----------------------------------------|---------|-----------------------------------------------------------------------------------------------|
| proportional_fee_in_millionths_sats    | string  | Optional, defaults to value in `coins` file. Fee per kb in millisatoshis. CONFIRM             |
| base_fee_msat                          | integer | Optional, defaults to value in `coins` file. Base fee in millisatoshis.                       |
| cltv_expiry_delta                      | integer | Optional, defaults to value in `coins` file. Seconds until CheckLockTimeVerify (CLTV) expiry. |
| max_dust_htlc_exposure_msat            | integer | Optional, defaults to value in `coins` file. Maximum exposure to dust from HashTimeLockContract (HTLC) transactions. CONFIRM  |
| force_close_avoidance_max_fee_satoshis | integer | Optional, defaults to value in `coins` file. Maximum fee to avoid forced closure in satoshis. CONFIRM  |


### LightningChannelConfig

| Parameter                          | Type    | Description                                                                                        |
|------------------------------------|---------|----------------------------------------------------------------------------------------------------|
| counterparty_locktime              | integer | Optional, defaults to value in `coins` file. Locktime in seconds for counterparty transactions.    |
| our_htlc_minimum_msat              | integer | Optional, defaults to value in `coins` file. Minimum msat reserved for HTLC transactions,          |
| negotiate_scid_privacy             | boolean | Optional, defaults to value in `coins` file. If `true`, I HAVE NO IDEA WHAT THIS MEANS             |
| max_inbound_in_flight_htlc_percent | integer | Optional, defaults to value in `coins` file. Maximum percentage of of HTLC funds inbound. CONFIRM  |
| announced_channel                  | boolean | Optional, defaults to value in `coins` file. If `true`, the channel has been announced.            |
| commit_upfront_shutdown_pubkey     | boolean | Optional, defaults to value in `coins` file. If `true`, I HAVE NO IDEA WHAT THIS MEANS             |


### LightningOpenChannelsFilter

| Parameter                   | Type    | Description                                                                                                     |
|-----------------------------|---------|-----------------------------------------------------------------------------------------------------------------|
| channel_id                  | string  | Optional. Unique string identifying a channel by its ID.                                                        |
| counterparty_node_id        | string  | Optional. A hexidecimal string identifying a counterparty node. |
| funding_tx                  | string  | Optional. A transaction ID which added funds.                   |
| from_funding_value_sats     | integer | Optional. The minimum value of channel funding in satoshis.     |
| to_funding_value_sats       | integer | Optional. The maximum value of channel funding in satoshis.     |
| is_outbound                 | boolean | Optional. If `true`, limits the response to outbound channels only. |
| from_balance_msat           | integer | Optional. The minimum channel balance in millisatoshis.     |
| to_balance_msat             | integer | Optional. The maximum channel balance in millisatoshis.     |
| from_outbound_capacity_msat | integer | Optional. The minimum outbound capacity of the channel balance in millisatoshis.  |
| to_outbound_capacity_msat   | integer | Optional. The maximum outbound capacity of the channel balance in millisatoshis.  |
| from_inbound_capacity_msat  | integer | Optional. The minimum inbound capacity of the channel balance in millisatoshis.   |
| to_inbound_capacity_msat    | integer | Optional. The maximum inbound capacity of the channel balance in millisatoshis.   |
| confirmed                   | boolean | Optional. If `true`, channel is confirmed NEED MORE INFO |
| is_usable                   | boolean | Optional. If `true`, channel is usable NEED MORE INFO    |
| is_public                   | boolean | Optional. If `true`, channel is public NEED MORE INFO    |


### LightningClosedChannelsFilter

| Parameter                   | Type    | Description                                                                                                     |
|-----------------------------|---------|-----------------------------------------------------------------------------------------------------------------|
| channel_id                  | string  | Optional. Unique string identifying a channel by its ID.                                                        |
| counterparty_node_id        | string  | Optional. A hexidecimal string identifying a counterparty node. |
| funding_tx                  | string  | Optional. A transaction ID which added funds.                   |
| from_funding_value          | integer | Optional. The minimum value of channel funding in satoshis. PARAM NAME NOT CONSISTENT.     |
| to_funding_value            | integer | Optional. The maximum value of channel funding in satoshis. PARAM NAME NOT CONSISTENT.     |
| channel_type                | string  | Optional. `Inbound` or `Outbound`. INCONSISTENT WITH `is_outbound` PARAM  |
| closing_tx                  | integer | Optional. A transaction ID which closed the channel.    |
| closure_reason              | integer | Optional. The reason a channel was closed.   |
| claiming_tx                 | integer | Optional. A transaction ID which claimed funds from the channel.    |
| from_claimed_balance        | integer | Optional. The minimum balance of channel funds claimed in satoshis.    |
| to_claimed_balance          | integer | Optional. The maximum balance of channel funds claimed in satoshis.    |
| channel_visibility          | integer | Optional. `Public` or `Private`.   |


### LightningActivationParams

| Parameter            | Type    | Description                                                                                                                  |
|----------------------|---------|------------------------------------------------------------------------------------------------------------------------------|
| name                 | string  | The name of the node that will be used in [lightning explorers](https://mempool.space/testnet/lightning/node/024e2a940e0cbeda84a0d5e00fa8e83b3f4e7f98382eedb488d058e0f5636dd164/r/n) |
| listening port       | integer | The port that this node listens for incoming connections on.                                                                 |
| color                | string  | A hexidecimal color string which will be used in network graphs on [lightning explorers](https://mempool.space/testnet/lightning/node/024e2a940e0cbeda84a0d5e00fa8e83b3f4e7f98382eedb488d058e0f5636dd164/r/n) |
| payment_retries      | integer | Optional, defaults to `X`. Number of times a payment will be retried if it fails.    CONFIRM DEFAULT VALUE                                        |
| backup_path          | string  | Optional. The backup path for channel backups, preferably on an external drive. |
