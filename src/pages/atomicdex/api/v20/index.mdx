# AtomicDEX API RPC Protocol v2.0

Starting with version [beta-2.1.3434](https://github.com/KomodoPlatform/atomicDEX-API/releases/tag/beta-2.1.3434), the AtomicDEX API supports the standardized protocol format called `mmrpc 2.0`.

It includes a uniform request, successful and error response formats. At the moment, only a few RPC methods support the `mmrpc 2.0` protocol.

## Request

| Structure | Type              | Description                                                                                                                                                       |
| --------- | ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| mmrpc     | string            | the string specifying the version of the AtomicDEX API RPC protocol. Must be exactly "2.0"                                                                        |
| userpass  | string (optional) | your password for protected RPC methods. Skip this field if the specified `method` is public                                                                      |
| method    | string            | the name of the method to be invoked                                                                                                                              |
| params    | object (optional) | a structured value that holds the parameter values to be used during the invocation of the method. This field may be omitted if the method doesn't take arguments |
| id        | number (optional) | the identifier is established by the client. AtomicDEX API will reply with the same value in the Response object if the `id` field is included and not `NULL`     |

### Response (Success)

| Structure | Type              | Description                                                                                 |
| --------- | ----------------- | ------------------------------------------------------------------------------------------- |
| mmrpc     | string            | the string specifying the version of the AtomicDEX API RPC protocol                         |
| result    | object            | the value of this field is determined by the method invoked on AtomicDEX API                |
| id        | number (optional) | the identifier established by the client. The same value as in the Request if it was passed |

### Response (Error)

| Structure   | Type              | Description                                                                                 |
| ----------- | ----------------- | ------------------------------------------------------------------------------------------- |
| mmrpc       | string            | the string specifying the version of the AtomicDEX API RPC protocol                         |
| error       | string            | the common error description                                                                |
| error_path  | string            | the error path consisting of file names separated by a dot similar to JSON path notation    |
| error_trace | string            | the error path consisting of file and line number pairs separated by ']'                    |
| error_type  | string            | the string error identifier used to determine the cause of the error                        |
| error_data  | object            | an object containing the error data of the corresponding `error_type`                       |
| id          | number (optional) | the identifier established by the client. The same value as in the Request if it was passed |

### ðŸ“Œ Examples

#### Command

<CodeGroup title="" tag="POST" label="withdraw">
```json {{ mm2MethodDecorate : true }}
{
  "mmrpc": "2.0",
  "userpass": "MM2_RPC_PASSWORD",
  "method": "withdraw",
  "params": {
    "coin": "KMD",
    "to": "RJTYiYeJ8eVvJ53n2YbrVmxWNNMVZjDGLh",
    "amount": "10"
  },
  "id": 0
}
```
</CodeGroup>

<CollapsibleSection expandedText='Hide Response' collapsedText='Show Response'>

#### Response (success)

```json
{
  "mmrpc": "2.0",
  "result": {
    "tx_hex": "0400008085202f8901ef25b1b7417fe7693097918ff90e90bba1351fff1f3a24cb51a9b45c5636e57e010000006b483045022100b05c870fcd149513d07b156e150a22e3e47fab4bb4776b5c2c1b9fc034a80b8f022038b1bf5b6dad923e4fb1c96e2c7345765ff09984de12bbb40b999b88b628c0f9012102031d4256c4bc9f99ac88bf3dba21773132281f65f9bf23a59928bce08961e2f3ffffffff0200e1f505000000001976a91405aab5342166f8594baf17a7d9bef5d56744332788ac8cbaae5f010000001976a91405aab5342166f8594baf17a7d9bef5d56744332788ace87a5e5d000000000000000000000000000000",
    "tx_hash": "1ab3bc9308695960bc728fa427ac00d1812c4ae89aaa714c7618cb96d111be58",
    "from": ["R9o9xTocqr6CeEDGDH6mEYpwLoMz6jNjMW"],
    "to": ["R9o9xTocqr6CeEDGDH6mEYpwLoMz6jNjMW"],
    "total_amount": "60.10253836",
    "spent_by_me": "60.10253836",
    "received_by_me": "60.00253836",
    "my_balance_change": "-0.1",
    "block_height": 0,
    "timestamp": 1566472936,
    "fee_details": {
      "type": "Utxo",
      "amount": "0.1"
    },
    "coin": "RICK",
    "internal_id": ""
  },
  "id": 0
}
```
</CollapsibleSection>

<CollapsibleSection expandedText='Hide Error Response' collapsedText='Show Error Response'>

#### Response (error)

```json
{
  "mmrpc": "2.0",
  "error": "The amount 0.000005 is too small",
  "error_path": "utxo_common",
  "error_trace": "utxo_common:1379] utxo_common:301]",
  "error_type": "AmountIsTooSmall",
  "error_data": {
    "amount": "0.000005"
  },
  "id": 0
}
```

</CollapsibleSection>

## Common AtomicDEX-API Request / Response Objects

The folowing objects are used in the request or response of multiple AtomicDEX-API methods.

### AddressInfos

The `addressInfos` object includes the following items for a given address:

| Parameter              | Type      | Description                                                                                                                                      |
| ---------------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| balances               | object    | A standard [balanceInfos](/atomicdex/api/v20#balance-infos) object. Not included in responses where `get_balances` is `false`  |
| derivation_method      | object    | A standard [DerivationMethod](/atomicdex/api/v20#derivation-method) object                                                     |
| pubkey                 | string    | The public key associated with the seed used to launch AtomicDEX                                                                                 |
| tickers                | array     | A list of tokens which were successfully activated. Only included in responses where `get_balances` is `false`                                   |


<CollapsibleSection expandedText='Hide Examples' collapsedText='Show Examples'>

#### Example with balances

```json
"bitcoincash:qrf5vpn78s7rjexrjhlwyzzeg7gw98k7t5qx64fztj": {
    "derivation_method": {
        "type": "Iguana"
    },
    "pubkey": "036879df230663db4cd083c8eeb0f293f46abc460ad3c299b0089b72e6d472202c",
    "balances": {
        "spendable": "0.11398301",
        "unspendable": "0.00001"
    }
}
```

#### Example without balances

```json
"bitcoincash:qrf5vpn78s7rjexrjhlwyzzeg7gw98k7t5qx64fztj": {
    "derivation_method": {
        "type": "Iguana"
    },
    "pubkey": "036879df230663db4cd083c8eeb0f293f46abc460ad3c299b0089b72e6d472202c",
    "tickers": ["ASLP-SLP"]
}
```

</CollapsibleSection>


### BalanceInfos

The `balanceInfos` object includes the following items for a given coin or token:

| Parameter     | Type             | Description                                                                                                               |
| ------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------- |
| spendable     | string (numeric) | The available amount of a coin or token which is ready to be traded or withdrawn.                                         |
| unspendable   | string (numeric) | The amount of a coin or token which is awaiting confirmation on the block chain for an incoming or outgoing transaction.  |


<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "spendable": "12.11398301",
    "unspendable": "0.53"
}
```

</CollapsibleSection>


### DerivationMethod

The `DerivationMethod` object includes the following items for a given coin or token:

| Parameter     | Type   | Description                                                                                        |
| ------------- | ------ | -------------------------------------------------------------------------------------------------- |
| type          | string | Defines how keypairs will be generated. Possible values: `Iguana` or `HDWallet`                    |

<Note>
Using the same seed or private key to generate keypairs using different derivation methods will result in a different address and private key for each method.
</Note>

Where the value indicates:
 - `Iguana`: The coin or token is was activated using Iguana derivation (default).
 - `HDWallet`: The coin or token is was activated using a Heirarchical Deterministic (HD) Wallet derivation path.

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "type": "Iguana"
}
```

</CollapsibleSection>


### EvmNode

The `EvmNode` object includes the following items for a given coin or token:

| Parameter | Type    | Description                                                                                                                                                                            |
| --------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| url       | string  | URL of an RPC node                                                                                                                                                                     |
| gui_auth  | boolean | Optional, defaults to `false`. Must be set to `true` to access RPC nodes run officially by the Komodo Platform team                                                                        |

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "url": "http://eth1.cipig.net:8555",
    "gui_auth": false
}
```

</CollapsibleSection>


### TokensRequest

The `TokensRequest` object includes the following items for a given coin or token:

| Parameter              | Type    | Description                                                                                                                                                                            |
| ---------------------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ticker                 | string  | Ticker of the token to be enabled                                                                                                                                                      |
| required_confirmations | integer | How many confirmations to wait during the transaction steps of an atomic swap. Overwrites value in coins file; defaults to `3`                                                         |

<CollapsibleSection expandedText='Hide Example' collapsedText='Show Example'>

#### Example

```json
{
    "ticker": "MINDS-ERC20",
    "required_confirmations": 4
}
```

</CollapsibleSection>


### WithdrawFee

The `WithdrawFee` object varies epending on the coin or token type. Refer to the examples to view the object structure for each type.


| Parameter     | Type             | Description                                                                                                                |
| ------------- | ---------------- | ---------------------------------------------------------------------------------------------------------------------------|
| type          | string           | The fee type. Either `Utxo`, `Tendermint`, `Qrc20` or `Eth`.                                                               |
| amount        | numeric string   | `Utxo` or `Tendermint` type only. The fee amount.                                                                          |
| coin          | string           | The coin which will be used to pay the transaction fee.                                                                    |
| gas           | integer          | `Eth` type only. The amount of gas to be used for the transaction.                                                         |
| gas_price     | numeric string   | `Eth` or `Qrc20` type only. Price per unit of gas to be used for the transaction.                                          |
| gas_limit     | numeric string   | `Tendermint` or `Qrc20` type only. Maximum gas to be used for the transaction.                                             |
| miner_fee     | numeric string   | `Tendermint` type only. Fee to mine the transaction.                                                                       |
| total_fee     | numeric string   | `Eth` type only. Gas price multiplied by gas amount.                                                                       |
| total_gas_fee | numeric string   | `Qrc20` type only. Gas price multiplied by gas amount.                                                                     |


<CollapsibleSection expandedText='Hide Examples' collapsedText='Show Examples'>

### Example of Eth type

```json
{
    "type": "Eth",
    "coin": "BNB",
    "gas": 109739,
    "gas_price": "0.000000003",
    "total_fee": "0.000329217"
}
```

### Example of Qrc20 type

```json
{
    "type": "Qrc20",
    "coin": "tQTUM",
    "miner_fee": "0.00000447",
    "gas_limit": 100000,
    "gas_price": 40,
    "total_gas_fee": "0.04"
}
```

### Example of Tendermint type

```json
{
    "type": "Tendermint",
    "coin": "IRIS",
    "amount": "0.038553",
    "gas_limit": 100000
}
```

### Example of Utxo type

```json
{
    "type": "Utxo",
    "amount": "0.00001"
}
```

### WithdrawType

The `WithdrawType` object is used for NFT withdrawals. It includes the following items for a given coin or token:


| Parameter     | Type             | Description                                                                                               |
| ------------- | ---------------- | ----------------------------------------------------------------------------------------------------------|
| type          | string           | The withdrawl type. Either `withdraw_erc721` or `withdraw_erc1155`.                                       |
| withdraw_data | object           | A standard [WithdrawData](/atomicdex/api/v20#withdraw-data) object.                                       |


### WithdrawData

The `WithdrawData` object is used for NFT withdrawals. It includes the following items for a given coin or token:


| Parameter     | Type             | Description                                                                                               |
| ------------- | ---------------- | ----------------------------------------------------------------------------------------------------------|
| chain         | string           | The token chain. Chain must be [activated](/atomicdex/api/legacy/coin_activation) first.                  |
| to            | string           | Destination address to withdraw the token to.                                                             |
| token_address | string           | Token address.                                                                                            |
| token_id      | string           | Token ID.                                                                                                 |
| amount        | string           | Optional, defaults to `1`. When sending more than one NFT, use the `withdraw_erc1155` withdraw type. Amount of NFTs to withdraw. |
| max           | boolean          | Optional, defaults to `false`. If `true`, amount parameter will be ignored and all NFTs with the `token_address` will be sent.   |
| fee           | string           | Optional. A standard [WithdrawFee](/atomicdex/api/v20#withdraw-fee) object.                                                      |

